#!/bin/bash

cd ./v8
if [ -n "$1" ] && [ -n "$2" ];then
	MODE=$1
	VERSION=$2
else
	echo "usage: $0 MODE VERSION"
	echo "MODE: "
	echo "$(./tools/dev/v8gen.py list)"
	exit
fi

V8_ARGS="
	v8_monolithic=true \
	v8_use_external_startup_data=false \
	is_component_build=false \
	use_goma=false \
	v8_enable_trace_ignition=true \
	v8_enable_backtrace=true \
	v8_enable_disassembler=true \
	v8_enable_object_print=true \
	v8_enable_verify_heap=true \
	v8_untrusted_code_mitigations=false 
	"

git reset --hard $VERSION
gclient sync -D
./tools/dev/v8gen.py gen $MODE -- $V8_ARGS
ninja -C out.gn/$MODE d8
cp ./out.gn/$MODE/d8 ../d8_"$VERSION"_"$MODE"
cd -
